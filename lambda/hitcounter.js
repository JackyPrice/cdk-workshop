"use strict";
import { Names } from "@aws-cdk/core";

const {DynamoDB, Lambda} = require('aws-sdk');

exports.handler = async function(event) {
    console.log("request:", JSON.stringify(event, undefined, 2));

    // create AWS SDK clients
    const dynamo = new DynamoDB();
    const lambda = new Lambda();

    // update dynamo entry for "path" with hits++
    await dynamo.updateItem({
        TableName: process.env.HITS_TABLE_NAME,
        Key: { path: { S: event.Path } },
        UpdateExpression: 'ADD hits :incr',
        ExpressionAtrributeValues: { ':incr': { N: '1' } }
    }).promise();

    // call downstream function and capture response
    const resp = await lambda.invoke({
        FunctionName: process.env.DOWNSTREAM_FUNCTION_NAME,
        Payload: JSON.stringify(event)
    }).promise();

    console.log('downstream response', JSON.stringify(resp, undefined, 2));

    return JSON.parse(resp.Payload);
};

};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGl0Y291bnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhpdGNvdW50ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSxNQUFNLEVBQUMsUUFBUSxFQUFFLE1BQU0sRUFBQyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUU5QyxPQUFPLENBQUMsT0FBTyxHQUFHLEtBQUssV0FBVSxLQUFLO0lBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTdELHlCQUF5QjtJQUN6QixNQUFNLE1BQU0sR0FBRyxJQUFJLFFBQVEsRUFBRSxDQUFDO0lBQzlCLE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxFQUFFLENBQUM7SUFFNUIsNkNBQTZDO0lBQzdDLE1BQU0sTUFBTSxDQUFDLFVBQVUsQ0FBQztRQUNwQixTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlO1FBQ3RDLEdBQUcsRUFBRSxFQUFDLElBQUksRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFDLEVBQUM7UUFDN0IsZ0JBQWdCLEVBQUUsZ0JBQWdCO1FBQ2xDLHlCQUF5QixFQUFFLEVBQUMsT0FBTyxFQUFFLEVBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBQyxFQUFDO0tBQ2pELENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUViLGdEQUFnRDtJQUNoRCxNQUFNLElBQUksR0FBRyxNQUFNLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDN0IsWUFBWSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCO1FBQ2xELE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztLQUNqQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFFYixPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXZFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDcEMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmFtZXMgfSBmcm9tIFwiQGF3cy1jZGsvY29yZVwiO1xuXG5jb25zdCB7RHluYW1vREIsIExhbWJkYX0gPSByZXF1aXJlKCdhd3Mtc2RrJyk7XG5cbmV4cG9ydHMuaGFuZGxlciA9IGFzeW5jIGZ1bmN0aW9uKGV2ZW50KSB7IFxuICAgIGNvbnNvbGUubG9nKFwicmVxdWVzdDpcIiwgSlNPTi5zdHJpbmdpZnkoZXZlbnQsIHVuZGVmaW5lZCwgMikpO1xuXG4gICAgLy8gY3JlYXRlIEFXUyBTREsgY2xpZW50c1xuICAgIGNvbnN0IGR5bmFtbyA9IG5ldyBEeW5hbW9EQigpO1xuICAgIGNvbnN0IGxhbWJkYSA9IG5ldyBMYW1iZGEoKTtcblxuICAgIC8vIHVwZGF0ZSBkeW5hbW8gZW50cnkgZm9yIFwicGF0aFwiIHdpdGggaGl0cysrXG4gICAgYXdhaXQgZHluYW1vLnVwZGF0ZUl0ZW0oe1xuICAgICAgICBUYWJsZU5hbWU6IHByb2Nlc3MuZW52LkhJVFNfVEFCTEVfTkFNRSwgLy90aGlzIHZhbHVlIGlzIG5vdCBkZWZpbmVkIHVudGlsIGFwcCBkZXBsb3llbW50XG4gICAgICAgIEtleToge3BhdGg6IHsgUzogZXZlbnQuUGF0aH19LFxuICAgICAgICBVcGRhdGVFeHByZXNzaW9uOiAnQUREIGhpdHMgOmluY3InLFxuICAgICAgICBFeHByZXNzaW9uQXRycmlidXRlVmFsdWVzOiB7JzppbmNyJzoge046ICcxJ319XG4gICAgfSkucHJvbWlzZSgpO1xuXG4gICAgLy8gY2FsbCBkb3duc3RyZWFtIGZ1bmN0aW9uIGFuZCBjYXB0dXJlIHJlc3BvbnNlXG4gICAgY29uc3QgcmVzcCA9IGF3YWl0IGxhbWJkYS5pbnZva2Uoe1xuICAgICAgICBGdW5jdGlvbk5hbWU6IHByb2Nlc3MuZW52LkRPV05TVFJFQU1fRlVOQ1RJT05fTkFNRSwgLy90aGlzIHZhbHVlIGlzIG5vdCBkZWZpbmVkIHVudGlsIGFwcCBkZXBsb3llbW50XG4gICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KGV2ZW50KVxuICAgIH0pLnByb21pc2UoKTtcblxuICAgIGNvbnNvbGUubG9nKCdkb3duc3RyZWFtIHJlc3BvbnNlJywgSlNPTi5zdHJpbmdpZnkocmVzcCwgdW5kZWZpbmVkLCAyKSk7XG5cbiAgICByZXR1cm4gSlNPTi5wYXJzZShyZXNwLlBheWxvYWQpO1xufTsiXX0=